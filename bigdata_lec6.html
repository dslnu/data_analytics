<!DOCTYPE html>
<html lang="en"><head>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-html/tabby.min.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.8.25">

  <meta name="author" content="MSDE">
  <title>Big Data analytics / Applied Data analytics – Big Data: Dask tutorial</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="site_libs/revealjs/dist/theme/quarto-534cd8e3a96973385dffff3f4709048d.css">
  <link rel="stylesheet" href="custom.css">
  <link href="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" class="quarto-title-block center">
  <h1 class="title">Big Data: Dask tutorial</h1>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
MSDE 
</div>
        <p class="quarto-title-affiliation">
            Lviv University
          </p>
    </div>
</div>

</section>
<section id="intro" class="slide level2">
<h2>Intro</h2>
<p><img data-src="https://docs.dask.org/en/latest/_images/dask_horizontal.svg" height="250"></p>
<ul>
<li>Dask is a parallel and distributed computing library that scales the existing Python and PyData ecosystem.</li>
<li>Dask can scale up to your full laptop capacity and out to a cloud cluster.</li>
</ul>
</section>
<section id="installation" class="slide level2">
<h2>Installation</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>With uv</strong></p>
</div>
<div class="callout-content">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb1"><pre class="sourceCode numberSource bash number-lines code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a></a><span class="ex">uv</span> add <span class="st">"dask[complete]"</span></span>
<span id="cb1-2"><a></a><span class="ex">uv</span> add s3fs</span>
<span id="cb1-3"><a></a><span class="ex">uv</span> add pyarrow</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="an-example-dask-computation" class="slide level2 font8">
<h2>An example Dask computation</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Example</strong></p>
</div>
<div class="callout-content">
<p>In the following lines of code, we’re reading the NYC taxi cab data from 2015 and finding the mean tip amount.</p>
<ol type="1">
<li>Import</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a></a><span class="im">import</span> dask.dataframe <span class="im">as</span> dd</span>
<span id="cb2-2"><a></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="2" type="1">
<li>Create client.</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a></a>client <span class="op">=</span> Client()</span>
<span id="cb3-2"><a></a>client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="3" type="1">
<li>Read data.</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a></a>ddf <span class="op">=</span> dd.read_parquet(</span>
<span id="cb4-2"><a></a>    <span class="st">"s3://dask-data/nyc-taxi/nyc-2015.parquet/part.*.parquet"</span>,</span>
<span id="cb4-3"><a></a>    columns<span class="op">=</span>[<span class="st">"passenger_count"</span>, <span class="st">"tip_amount"</span>],</span>
<span id="cb4-4"><a></a>    storage_options<span class="op">=</span>{<span class="st">"anon"</span>: <span class="va">True</span>},</span>
<span id="cb4-5"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<ol start="4" type="1">
<li>Groupby and mean</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a></a>result <span class="op">=</span> ddf.groupby(<span class="st">"passenger_count"</span>).tip_amount.mean().compute()</span>
<span id="cb5-2"><a></a>result</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="what-is-dask" class="slide level2">
<h2>What is <a href="&quot;https://www.dask.org/&quot;">Dask</a>?</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Many parts</strong></p>
</div>
<div class="callout-content">
<p>There are many parts to the “Dask” the project:</p>
<ul>
<li>Collections/API also known as “core-library”.</li>
<li>Distributed – to create clusters</li>
<li>Integrations and broader ecosystem</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-collections" class="slide level2 font8">
<h2>Dask Collections</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Overview</strong></p>
</div>
<div class="callout-content">
<p>Dask provides <strong>multi-core</strong> and <strong>distributed+parallel</strong> execution on <strong>larger-than-memory</strong> datasets</p>
<p><img data-src="img/high_vs_low_level_coll_analogy.png" height="350"></p>
<ul>
<li><strong>High-level collections:</strong> Dask provides high-level Array, Bag, and DataFrame collections that mimic NumPy, lists, and pandas but can operate in parallel on datasets that don’t fit into memory.</li>
<li><strong>Low-level collections:</strong> Dask also provides low-level Delayed and Futures collections that give you finer control to build custom parallel and distributed computations.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-cluster" class="slide level2">
<h2>Dask Cluster</h2>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Cluster</strong></p>
</div>
<div class="callout-content">
<p>Most of the times when you are using Dask, you will be using a distributed scheduler, which exists in the context of a Dask cluster. The Dask cluster is structured as:</p>
</div>
</div>
</div>

<img data-src="img/distributed-overview.png" class="r-stretch"></section>
<section id="dask-ecosystem" class="slide level2">
<h2>Dask Ecosystem</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Libraries</strong></p>
</div>
<div class="callout-content">
<p>In addition to the core Dask library and its distributed scheduler, the Dask ecosystem connects several additional initiatives, including:</p>
<ul>
<li>Dask-ML (parallel scikit-learn-style API)</li>
<li>Dask-image</li>
<li>Dask-cuDF</li>
<li>Dask-sql</li>
<li>Dask-snowflake</li>
<li>Dask-mongo</li>
<li>Dask-bigquery</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-ecosystem-1" class="slide level2 font8">
<h2>Dask Ecosystem</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Community ibraries</strong></p>
</div>
<div class="callout-content">
<p>Community libraries that have built-in dask integrations like:</p>
<ul>
<li>Xarray</li>
<li>XGBoost</li>
<li>Prefect</li>
<li>Airflow</li>
</ul>
<p>Dask deployment libraries</p>
<ul>
<li>Dask-kubernetes</li>
<li>Dask-YARN</li>
<li>Dask-gateway</li>
<li>Dask-cloudprovider</li>
<li>jobqueue</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-use-cases" class="slide level2">
<h2>Dask Use Cases</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Use cases</strong></p>
</div>
<div class="callout-content">
<p>Dask is used in multiple fields such as:</p>
<ul>
<li>Geospatial</li>
<li>Finance</li>
<li>Astrophysics</li>
<li>Microbiology</li>
<li>Environmental science</li>
</ul>
<p>Check out the Dask <a href="https://stories.dask.org/en/latest/">use cases</a> page that provides a number of sample workflows.</p>
</div>
</div>
</div>
</section>
<section>
<section id="dataframe" class="title-slide slide level1 center">
<h1>Dataframe</h1>

</section>
<section id="dask-dataframe---parallelized-pandas" class="slide level2">
<h2>Dask DataFrame - parallelized pandas</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Description</strong></p>
</div>
<div class="callout-content">
<p>Looks and feels like the pandas API, but for parallel and distributed workflows.</p>
<ul>
<li><p>At its core, the <code>dask.dataframe</code> module implements a “blocked parallel” <code>DataFrame</code> object that looks and feels like the pandas API, but for parallel and distributed workflows.</p></li>
<li><p>One Dask <code>DataFrame</code> is comprised of many in-memory pandas <code>DataFrame</code>s separated along the index.</p></li>
<li><p>One operation on a Dask <code>DataFrame</code> triggers many pandas operations on the constituent pandas <code>DataFrame</code>s in a way that is mindful of potential parallelism and memory constraints.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-dataframe" class="slide level2">
<h2>Dask DataFrame</h2>

<img data-src="https://docs.dask.org/en/stable/_images/dask-dataframe.svg" class="r-stretch"></section>
<section id="dask-dataframe-1" class="slide level2">
<h2>Dask DataFrame</h2>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Related Documentation</strong></p>
</div>
<div class="callout-content">
<ul>
<li><a href="https://docs.dask.org/en/latest/dataframe.html">DataFrame documentation</a></li>
<li><a href="https://youtu.be/AT2XtFehFSQ">DataFrame screencast</a></li>
<li><a href="https://docs.dask.org/en/latest/dataframe-api.html">DataFrame API</a></li>
<li><a href="https://examples.dask.org/dataframe.html">DataFrame examples</a></li>
<li><a href="https://pandas.pydata.org/pandas-docs/stable/">pandas documentation</a></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dataframe-1" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>When to use <code>dask.dataframe</code></strong></p>
</div>
<div class="callout-content">
<p>pandas is great for tabular datasets that fit in memory. A general rule of thumb for pandas is:</p>
<blockquote>
<p>“Have 5 to 10 times as much RAM as the size of your dataset”</p>
</blockquote>
<blockquote>
<p>~ Wes McKinney (2017) in <a href="https://wesmckinney.com/blog/apache-arrow-pandas-internals/">10 things I hate about pandas</a></p>
</blockquote>
<p>Here “size of dataset” means dataset size on <em>the disk</em>.</p>
<p>Dask becomes useful when the datasets exceed the above rule.</p>
<p>In this notebook, you will be working with the New York City Airline data. This dataset is only ~200MB, so that you can download it in a reasonable time, but <code>dask.dataframe</code> will scale to datasets <strong>much</strong> larger than memory.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-2" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Create datasets</strong></p>
</div>
<div class="callout-content">
<p>Create the datasets you will be using in this notebook:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a></a><span class="op">%</span>run prep.py <span class="op">-</span>d flights</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Set up your local cluster</strong></p>
</div>
<div class="callout-content">
<p>Create a local Dask cluster and connect it to the client.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span>
<span id="cb7-2"><a></a></span>
<span id="cb7-3"><a></a>client <span class="op">=</span> Client(n_workers<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb7-4"><a></a>client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-3" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Dask Diagnostic Dashboard</strong></p>
</div>
<div class="callout-content">
<p>Dask Distributed provides a useful Dashboard to visualize the state of your cluster and computations.</p>
<p>Click on the dashboard link displayed in the Client details above: <a href="http://127.0.0.1:8787/status" class="uri">http://127.0.0.1:8787/status</a>. It will open a new browser tab with the Dashboard.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-4" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Reading and working with datasets</strong></p>
</div>
<div class="callout-content">
<p>Let’s read an extract of flights in the USA across several years. This data is specific to flights out of the three airports in the New York City area.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a></a><span class="im">import</span> os</span>
<span id="cb8-2"><a></a><span class="im">import</span> dask</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>By convention, we import the module <code>dask.dataframe</code> as <code>dd</code>, and call the corresponding <code>DataFrame</code> object <code>ddf</code>.</p>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The term “Dask DataFrame” is slightly overloaded. Depending on the context, it can refer to the module or the DataFrame object. To avoid confusion:</p>
<ul>
<li><code>dask.dataframe</code> (note the all lowercase) refers to the API, and</li>
<li><code>DataFrame</code> (note the CamelCase) refers to the object.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dataframe-5" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Reading and working with datasets</strong></p>
</div>
<div class="callout-content">
<p>The following filename includes a glob pattern <code>*</code>, so all files in the path matching that pattern will be read into the same <code>DataFrame</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a></a><span class="im">import</span> dask.dataframe <span class="im">as</span> dd</span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a>ddf <span class="op">=</span> dd.read_csv(</span>
<span id="cb9-4"><a></a>    os.path.join(<span class="st">"data"</span>, <span class="st">"nycflights"</span>, <span class="st">"*.csv"</span>), parse_dates<span class="op">=</span>{<span class="st">"Date"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]}</span>
<span id="cb9-5"><a></a>)</span>
<span id="cb9-6"><a></a>ddf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-6" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>What happened?</strong></p>
</div>
<div class="callout-content">
<p>Dask has not loaded the data yet, it has:</p>
<ul>
<li>investigated the input path and found that there are ten matching files</li>
<li>intelligently created a set of jobs for each chunk – one per original CSV file in this case</li>
</ul>
</div>
</div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>Notice that the representation of the <code>DataFrame</code> object contains no data - Dask has just done enough to read the start of the first file, and infer the column names and <code>dtype</code>s.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-7" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Lazy Evaluation</strong></p>
</div>
<div class="callout-content">
<p>Most Dask Collections, including Dask <code>DataFrame</code> are evaluated lazily, which means Dask constructs the logic (called task graph) of your computation immediately but “evaluates” them only when necessary.</p>
<p>You can view this task graph using <code>.visualize()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a></a>ddf.visualize()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Note that we need to call <code>.compute()</code> to trigger actual computations.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-8" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Lazy Evaluation</strong></p>
</div>
<div class="callout-content">
<p>Some functions like <code>len</code> and <code>head</code> also trigger a computation. Specifically, calling <code>len</code> will:</p>
<ul>
<li>load actual data, (that is, load each file into a pandas DataFrame)</li>
<li>then apply the corresponding functions to each pandas DataFrame (also known as a partition)</li>
<li>combine the subtotals to give you the final grand total</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a></a><span class="co"># load and count number of rows</span></span>
<span id="cb11-2"><a></a><span class="bu">len</span>(ddf)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-9" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Lazy Evaluation</strong></p>
</div>
<div class="callout-content">
<p>You can view the start and end of the data as you would in pandas:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a></a>ddf.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb13"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a></a>ddf.tail()</span>
<span id="cb13-2"><a></a></span>
<span id="cb13-3"><a></a><span class="co"># ValueError: Mismatched dtypes found in `pd.read_csv`/`pd.read_table`.</span></span>
<span id="cb13-4"><a></a></span>
<span id="cb13-5"><a></a><span class="co"># +----------------+---------+----------+</span></span>
<span id="cb13-6"><a></a><span class="co"># | Column         | Found   | Expected |</span></span>
<span id="cb13-7"><a></a><span class="co"># +----------------+---------+----------+</span></span>
<span id="cb13-8"><a></a><span class="co"># | CRSElapsedTime | float64 | int64    |</span></span>
<span id="cb13-9"><a></a><span class="co"># | TailNum        | object  | float64  |</span></span>
<span id="cb13-10"><a></a><span class="co"># +----------------+---------+----------+</span></span>
<span id="cb13-11"><a></a></span>
<span id="cb13-12"><a></a><span class="co"># The following columns also raised exceptions on conversion:</span></span>
<span id="cb13-13"><a></a></span>
<span id="cb13-14"><a></a><span class="co"># - TailNum</span></span>
<span id="cb13-15"><a></a><span class="co">#   ValueError("could not convert string to float: 'N54711'")</span></span>
<span id="cb13-16"><a></a></span>
<span id="cb13-17"><a></a><span class="co"># Usually this is due to dask's dtype inference failing, and</span></span>
<span id="cb13-18"><a></a><span class="co"># *may* be fixed by specifying dtypes manually by adding:</span></span>
<span id="cb13-19"><a></a></span>
<span id="cb13-20"><a></a><span class="co"># dtype={'CRSElapsedTime': 'float64',</span></span>
<span id="cb13-21"><a></a><span class="co">#        'TailNum': 'object'}</span></span>
<span id="cb13-22"><a></a></span>
<span id="cb13-23"><a></a><span class="co"># to the call to `read_csv`/`read_table`.</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-10" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Handling conflicting types</strong></p>
</div>
<div class="callout-content">
<p>Unlike <code>pandas.read_csv</code> which reads in the entire file before inferring datatypes, <code>dask.dataframe.read_csv</code> only reads in a sample from the beginning of the file (or first file if using a glob). These inferred datatypes are then enforced when reading all partitions.</p>
<p>In this case, the datatypes inferred in the sample are incorrect. The first <code>n</code> rows have no value for <code>CRSElapsedTime</code> (which pandas infers as a <code>float</code>), and later on turn out to be strings (<code>object</code> dtype). When this happens you have a few options:</p>
<ul>
<li>Specify dtypes directly using the <code>dtype</code> keyword. This is the recommended solution, as it’s the least error prone (better to be explicit than implicit) and also the most performant.</li>
<li>Increase the size of the <code>sample</code> keyword (in bytes)</li>
<li>Use <code>assume_missing</code> to make <code>dask</code> assume that columns inferred to be <code>int</code> (which don’t allow missing values) are actually <code>floats</code> (which do allow missing values). In our particular case this doesn’t apply.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dataframe-11" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Handling conflicting types</strong></p>
</div>
<div class="callout-content">
<p>In our case we’ll use the first option and directly specify the <code>dtypes</code> of the offending columns.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a></a>ddf <span class="op">=</span> dd.read_csv(</span>
<span id="cb14-2"><a></a>    os.path.join(<span class="st">"data"</span>, <span class="st">"nycflights"</span>, <span class="st">"*.csv"</span>),</span>
<span id="cb14-3"><a></a>    parse_dates<span class="op">=</span>{<span class="st">"Date"</span>: [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>]},</span>
<span id="cb14-4"><a></a>    dtype<span class="op">=</span>{<span class="st">"TailNum"</span>: <span class="bu">str</span>, <span class="st">"CRSElapsedTime"</span>: <span class="bu">float</span>, <span class="st">"Cancelled"</span>: <span class="bu">bool</span>},</span>
<span id="cb14-5"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a></a>ddf.tail()  <span class="co"># now works</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-12" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Reading from remote storage</strong></p>
</div>
<div class="callout-content">
<p>If you’re thinking about distributed computing, your data is probably stored remotely on services (like Amazon’s S3 or Google’s cloud storage) and is in a friendlier format (like Parquet). Dask can read data in various formats directly from these remote locations <strong>lazily</strong> and <strong>in parallel</strong>.</p>
<p>Here’s how you can read the NYC taxi cab data from Amazon S3:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb16"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a></a>ddf <span class="op">=</span> dd.read_parquet(</span>
<span id="cb16-2"><a></a>    <span class="st">"s3://nyc-tlc/trip data/yellow_tripdata_2012-*.parquet"</span>,</span>
<span id="cb16-3"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can also leverage Parquet-specific optimizations like column selection and metadata handling, learn more in <a href="https://docs.dask.org/en/stable/dataframe-parquet.html">the Dask documentation on working with Parquet files</a>.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-13" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Computations with <code>dask.dataframe</code></strong></p>
</div>
<div class="callout-content">
<p>Let’s compute the maximum of the flight delay.</p>
<p>With just pandas, we would loop over each file to find the individual maximums, then find the final maximum over all the individual maximums.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb17-2"><a></a></span>
<span id="cb17-3"><a></a>files <span class="op">=</span> os.listdir(os.path.join(<span class="st">'data'</span>, <span class="st">'nycflights'</span>))</span>
<span id="cb17-4"><a></a></span>
<span id="cb17-5"><a></a>maxes <span class="op">=</span> []</span>
<span id="cb17-6"><a></a></span>
<span id="cb17-7"><a></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> files:</span>
<span id="cb17-8"><a></a>    df <span class="op">=</span> pd.read_csv(os.path.join(<span class="st">'data'</span>, <span class="st">'nycflights'</span>, <span class="bu">file</span>))</span>
<span id="cb17-9"><a></a>    maxes.append(df.DepDelay.<span class="bu">max</span>())</span>
<span id="cb17-10"><a></a>    </span>
<span id="cb17-11"><a></a>final_max <span class="op">=</span> <span class="bu">max</span>(maxes)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-14" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Computations with <code>dask.dataframe</code></strong></p>
</div>
<div class="callout-content">
<p><code>dask.dataframe</code> lets us write pandas-like code, that operates on larger-than-memory datasets in parallel.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a></a><span class="op">%%</span>time</span>
<span id="cb18-2"><a></a>result <span class="op">=</span> ddf.DepDelay.<span class="bu">max</span>()</span>
<span id="cb18-3"><a></a>result.compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>This creates the lazy computation for us and then runs it.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-15" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Computations with <code>dask.dataframe</code></strong></p>
</div>
<div class="callout-content">
<p>Dask will delete intermediate results (like the full pandas DataFrame for each file) as soon as possible. This means you can handle datasets that are larger than memory but, repeated computations will have to load all of the data in each time. (Run the code above again, is it faster or slower than you would expect?)</p>
<p>You can view the underlying task graph using <code>.visualize()</code>:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb19"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a></a><span class="co"># notice the parallelism</span></span>
<span id="cb19-2"><a></a>result.visualize()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-16" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercises</strong></p>
</div>
<div class="callout-content">
<ol type="1">
<li>How many rows are in our dataset?</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- len(ddf) -->
<!-- ``` -->
<ol start="2" type="1">
<li>In total, how many non-canceled flights were taken?</li>
</ol>
<p><em>Hint</em>: use <a href="https://pandas.pydata.org/pandas-docs/stable/indexing.html#boolean-indexing">boolean indexing</a>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- len(ddf[~ddf.Cancelled]) -->
<!-- ``` -->
</div>
</div>
</div>
</section>
<section id="dataframe-17" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercises</strong></p>
</div>
<div class="callout-content">
<ol start="3" type="1">
<li>In total, how many non-canceled flights were taken from each airport?</li>
</ol>
<p><em>Hint</em>: use <a href="https://pandas.pydata.org/pandas-docs/stable/groupby.html">groupby</a>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb22"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- ddf[~ddf.Cancelled].groupby("Origin").Origin.count().compute() -->
<!-- ``` -->
<ol start="4" type="1">
<li>What was the average departure delay from each airport?</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- ddf.groupby("Origin").DepDelay.mean().compute() -->
<!-- ``` -->
</div>
</div>
</div>
</section>
<section id="dataframe-18" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercises</strong></p>
</div>
<div class="callout-content">
<ol start="5" type="1">
<li>What day of the week has the worst average departure delay?</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- ddf.groupby("DayOfWeek").DepDelay.mean().idxmax().compute() -->
<!-- ``` -->
<ol start="6" type="1">
<li>Let’s say the distance column is erroneous and you need to add 1 to all values, how would you do this?</li>
</ol>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- ddf["Distance"].apply( -->
<!--     lambda x: x + 1 -->
<!-- ).compute()  # don't worry about the warning, we'll discuss in the next sections -->
<!-- # OR -->
<!-- (ddf["Distance"] + 1).compute() -->
<!-- ``` -->
</div>
</div>
</div>
</section>
<section id="dataframe-19" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Sharing Intermediate Results</strong></p>
</div>
<div class="callout-content">
<p>When computing all of the above, we sometimes did the same operation more than once. For most operations, <code>dask.dataframe</code> stores the arguments, allowing duplicate computations to be shared and only computed once.</p>
<p>For example, let’s compute the mean and standard deviation for departure delay of all non-canceled flights.</p>
<p>If you compute them with two calls to compute, there is no sharing of intermediate computations.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a></a>non_canceled <span class="op">=</span> ddf[<span class="op">~</span>ddf.Cancelled]</span>
<span id="cb26-2"><a></a>mean_delay <span class="op">=</span> non_canceled.DepDelay.mean()</span>
<span id="cb26-3"><a></a>std_delay <span class="op">=</span> non_canceled.DepDelay.std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a></a><span class="co">#| tags: []</span></span>
<span id="cb27-2"><a></a><span class="op">%%</span>time</span>
<span id="cb27-3"><a></a></span>
<span id="cb27-4"><a></a>mean_delay_res <span class="op">=</span> mean_delay.compute()</span>
<span id="cb27-5"><a></a>std_delay_res <span class="op">=</span> std_delay.compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-20" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><code>dask.compute</code></strong></p>
</div>
<div class="callout-content">
<p>But let’s try by passing both to a single <code>compute</code> call.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a></a><span class="co">#| tags: []</span></span>
<span id="cb28-2"><a></a><span class="op">%%</span>time</span>
<span id="cb28-3"><a></a></span>
<span id="cb28-4"><a></a>mean_delay_res, std_delay_res <span class="op">=</span> dask.compute(mean_delay, std_delay)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Using <code>dask.compute</code> takes roughly 1/2 the time. This is because the task graphs for both results are merged when calling <code>dask.compute</code>, allowing shared operations to only be done once instead of twice. In particular, using <code>dask.compute</code> only does the following once:</p>
<ul>
<li>the calls to <code>read_csv</code></li>
<li>the filter (<code>df[~df.Cancelled]</code>)</li>
<li>some of the necessary reductions (<code>sum</code>, <code>count</code>)</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dataframe-21" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Visualization</strong></p>
</div>
<div class="callout-content">
<ul>
<li>To see what the merged task graphs between multiple results look like (and what’s shared), you can use the <code>dask.visualize</code> function</li>
<li>you might want to use <code>filename='graph.pdf'</code> to save the graph to disk so that you can zoom in more easily</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a></a>dask.visualize(mean_delay, std_delay, engine<span class="op">=</span><span class="st">"cytoscape"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-22" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><code>.persist()</code></strong></p>
</div>
<div class="callout-content">
<p>While using a distributed scheduler (you will learn more about schedulers in the upcoming notebooks), you can keep some <em>data that you want to use often</em> in the <em>distributed memory</em>.</p>
<p><code>persist</code> generates “Futures” (more on this later as well) and stores them in the same structure as your output. You can use <code>persist</code> with any data or computation that fits in memory.</p>
<p>If you want to analyze data only for non-canceled flights departing from JFK airport, you can either have two compute calls like in the previous section:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a></a>non_cancelled <span class="op">=</span> ddf[<span class="op">~</span>ddf.Cancelled]</span>
<span id="cb30-2"><a></a>ddf_jfk <span class="op">=</span> non_cancelled[non_cancelled.Origin <span class="op">==</span> <span class="st">"JFK"</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a></a><span class="op">%%</span>time</span>
<span id="cb31-2"><a></a>ddf_jfk.DepDelay.mean().compute()</span>
<span id="cb31-3"><a></a>ddf_jfk.DepDelay.<span class="bu">sum</span>().compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-23" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><code>.persist()</code></strong></p>
</div>
<div class="callout-content">
<p>Or, consider persisting that subset of data in memory.</p>
<p>See the “Graph” dashboard plot, the red squares indicate persisted data stored as Futures in memory. You will also notice an increase in Worker Memory (another dashboard plot) consumption.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a></a>ddf_jfk <span class="op">=</span> ddf_jfk.persist()  <span class="co"># returns back control immediately</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a></a><span class="op">%%</span>time</span>
<span id="cb33-2"><a></a>ddf_jfk.DepDelay.mean().compute()</span>
<span id="cb33-3"><a></a>ddf_jfk.DepDelay.std().compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Analyses on this persisted data is faster because we are not repeating the loading and selecting (non-canceled, JFK departure) operations.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-24" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Custom code with Dask DataFrame</strong></p>
</div>
<div class="callout-content">
<p><code>dask.dataframe</code> only covers a small but well-used portion of the pandas API.</p>
<p>This limitation is for two reasons:</p>
<ol type="1">
<li>The Pandas API is <em>huge</em></li>
<li>Some operations are genuinely hard to do in parallel, e.g, sorting.</li>
</ol>
<p>Additionally, some important operations like <code>set_index</code> work, but are slower than in pandas because they include substantial shuffling of data, and may write out to disk.</p>
</div>
</div>
</div>
</section>
<section id="dataframe-25" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Solutions</strong></p>
</div>
<div class="callout-content">
<p>In case it’s a custom function or tricky to implement, <code>dask.dataframe</code> provides a few methods to make applying custom functions to Dask DataFrames easier:</p>
<ul>
<li><a href="https://docs.dask.org/en/latest/generated/dask.dataframe.DataFrame.map_partitions.html"><code>map_partitions</code></a>: to run a function on each partition (each pandas DataFrame) of the Dask DataFrame</li>
<li><a href="https://docs.dask.org/en/latest/generated/dask.dataframe.rolling.map_overlap.html"><code>map_overlap</code></a>: to run a function on each partition (each pandas DataFrame) of the Dask DataFrame, with some rows shared between neighboring partitions</li>
<li><a href="https://docs.dask.org/en/latest/generated/dask.dataframe.Series.reduction.html"><code>reduction</code></a>: for custom row-wise reduction operations.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dataframe-26" class="slide level2 scrollable">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong><code>map_partitions</code></strong></p>
</div>
<div class="callout-content">
<p>Let’s take a quick look at the <code>map_partitions()</code> function:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a></a><span class="co">#| tags: []</span></span>
<span id="cb34-2"><a></a><span class="bu">help</span>(ddf.map_partitions)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>The “Distance” column in <code>ddf</code> is currently in miles. Let’s say we want to convert the units to kilometers and we have a general helper function as shown below. In this case, we can use <code>map_partitions</code> to apply this function across each of the internal pandas <code>DataFrame</code>s in parallel.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a></a><span class="kw">def</span> my_custom_converter(df, multiplier<span class="op">=</span><span class="dv">1</span>):</span>
<span id="cb35-2"><a></a>    <span class="cf">return</span> df <span class="op">*</span> multiplier</span>
<span id="cb35-3"><a></a></span>
<span id="cb35-4"><a></a></span>
<span id="cb35-5"><a></a>meta <span class="op">=</span> pd.Series(name<span class="op">=</span><span class="st">"Distance"</span>, dtype<span class="op">=</span><span class="st">"float64"</span>)</span>
<span id="cb35-6"><a></a></span>
<span id="cb35-7"><a></a>distance_km <span class="op">=</span> ddf.Distance.map_partitions(</span>
<span id="cb35-8"><a></a>    my_custom_converter, multiplier<span class="op">=</span><span class="fl">0.6</span>, meta<span class="op">=</span>meta</span>
<span id="cb35-9"><a></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a></a>distance_km.visualize()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a></a>distance_km.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dataframe-27" class="slide level2">
<h2>DataFrame</h2>
<div class="callout callout-tip no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>What is <code>meta</code>?</strong></p>
</div>
<div class="callout-content">
<p>Since Dask operates lazily, it doesn’t always have enough information to infer the output structure (which includes datatypes) of certain operations.</p>
<p><code>meta</code> is a <em>suggestion</em> to Dask about the output of your computation. Importantly, <code>meta</code> <em>never infers with the output structure</em>. Dask uses this <code>meta</code> until it can determine the actual output structure.</p>
<p>Even though there are many ways to define <code>meta</code>, we suggest using a small pandas Series or DataFrame that matches the structure of your final output.</p>
</div>
</div>
</div>
</section>
<section id="close-you-local-dask-cluster" class="slide level2">
<h2>Close you local Dask Cluster</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>It’s good practice to always close any Dask cluster you create:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a></a>client.shutdown()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section></section>
<section>
<section id="dask-arrays" class="title-slide slide level1 center">
<h1>Dask Arrays</h1>

</section>
<section id="dask-arrays-1" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Dask Arrays - parallelized numpy</strong></p>
</div>
<div class="callout-content">
<p>Parallel, larger-than-memory, n-dimensional array using blocked algorithms.</p>
<ul>
<li><strong>Parallel</strong>: Uses all of the cores on your computer</li>
<li><strong>Larger-than-memory</strong>: Lets you work on datasets that are larger than your available memory by breaking up your array into many small pieces, operating on those pieces in an order that minimizes the memory footprint of your computation, and effectively streaming data from disk.</li>
<li><strong>Blocked Algorithms</strong>: Perform large computations by performing many smaller computations.</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-2" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Dask Arrays - parallelized numpy</strong></p>
</div>
<div class="callout-content">
<p><img data-src="https://docs.dask.org/en/stable/_images/dask-array.svg"></p>
</div>
</div>
</div>
</section>
<section id="dask-arrays-3" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Related Documentation</strong></p>
</div>
<div class="callout-content">
<ul>
<li><a href="https://docs.dask.org/en/latest/array.html">Array documentation</a></li>
<li><a href="https://youtu.be/9h_61hXCDuI">Array screencast</a></li>
<li><a href="https://docs.dask.org/en/latest/array-api.html">Array API</a></li>
<li><a href="https://examples.dask.org/array.html">Array examples</a></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-4" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Create datasets</strong></p>
</div>
<div class="callout-content">
<p>Create the datasets you will be using in this notebook:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb39"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a></a><span class="op">%</span>run prep.py <span class="op">-</span>d random</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-5" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Start the Client</strong></p>
</div>
<div class="callout-content">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a></a><span class="im">from</span> dask.distributed <span class="im">import</span> Client</span>
<span id="cb40-2"><a></a></span>
<span id="cb40-3"><a></a>client <span class="op">=</span> Client(n_workers<span class="op">=</span><span class="dv">4</span>)</span>
<span id="cb40-4"><a></a>client</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-6" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Blocked Algorithms in a nutshell</strong></p>
</div>
<div class="callout-content">
<p>Let’s do side by side the sum of the elements of an array using a NumPy array and a Dask array.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb41"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb41-2"><a></a><span class="im">import</span> dask.array <span class="im">as</span> da</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a></a><span class="co"># NumPy array</span></span>
<span id="cb42-2"><a></a>a_np <span class="op">=</span> np.ones(<span class="dv">10</span>)</span>
<span id="cb42-3"><a></a>a_np</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-7" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Blocked Algorithms in a nutshell</strong></p>
</div>
<div class="callout-content">
<p>We know that we can use <code>sum()</code> to compute the sum of the elements of our array, but to show what a blocksized operation would look like, let’s do:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb43"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a></a>a_np_sum <span class="op">=</span> a_np[:<span class="dv">5</span>].<span class="bu">sum</span>() <span class="op">+</span> a_np[<span class="dv">5</span>:].<span class="bu">sum</span>()</span>
<span id="cb43-2"><a></a>a_np_sum</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Now notice that each sum in the computation above is completely independent so they could be done in parallel. To do this with Dask array, we need to define our “slices”, we do this by defining the amount of elements we want per block using the variable <code>chunks</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a></a>a_da <span class="op">=</span> da.ones(<span class="dv">10</span>, chunks<span class="op">=</span><span class="dv">5</span>)</span>
<span id="cb44-2"><a></a>a_da</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-8" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-important callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Important</strong></p>
</div>
<div class="callout-content">
<p>Note here that to get two blocks, we specify <code>chunks=5</code>, in other words, we have 5 elements per block.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a></a>a_da_sum <span class="op">=</span> a_da.<span class="bu">sum</span>()</span>
<span id="cb45-2"><a></a>a_da_sum</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-9" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Task Graphs</strong></p>
</div>
<div class="callout-content">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb46"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a></a><span class="co"># visualize the low level Dask graph using cytoscape</span></span>
<span id="cb46-2"><a></a>a_da_sum.visualize(engine<span class="op">=</span><span class="st">"cytoscape"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>And then compute:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a></a>a_da_sum.compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-10" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Performance comparison</strong></p>
</div>
<div class="callout-content">
<p>Let’s try a more interesting example. We will create a 20_000 x 20_000 array with normally distributed values, and take the mean along one of its axis.</p>
<h4 id="numpy-version">Numpy version</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a></a><span class="op">%%</span>time</span>
<span id="cb48-2"><a></a>xn <span class="op">=</span> np.random.normal(<span class="dv">10</span>, <span class="fl">0.1</span>, size<span class="op">=</span>(<span class="dv">30_000</span>, <span class="dv">30_000</span>))</span>
<span id="cb48-3"><a></a>yn <span class="op">=</span> xn.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb48-4"><a></a>yn</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<h4 id="dask-array-version">Dask array version</h4>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb49"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a></a>xd <span class="op">=</span> da.random.normal(<span class="dv">10</span>, <span class="fl">0.1</span>, size<span class="op">=</span>(<span class="dv">30_000</span>, <span class="dv">30_000</span>), chunks<span class="op">=</span>(<span class="dv">3000</span>, <span class="dv">3000</span>))</span>
<span id="cb49-2"><a></a>xd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a></a>xd.nbytes <span class="op">/</span> <span class="fl">1e9</span>  <span class="co"># Gigabytes of the input processed lazily</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a></a>yd <span class="op">=</span> xd.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb51-2"><a></a>yd</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-11" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Performance comparison</strong></p>
</div>
<div class="callout-content">
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a></a><span class="op">%%</span>time</span>
<span id="cb52-2"><a></a>xd <span class="op">=</span> da.random.normal(<span class="dv">10</span>, <span class="fl">0.1</span>, size<span class="op">=</span>(<span class="dv">30_000</span>, <span class="dv">30_000</span>), chunks<span class="op">=</span>(<span class="dv">3000</span>, <span class="dv">3000</span>))</span>
<span id="cb52-3"><a></a>yd <span class="op">=</span> xd.mean(axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb52-4"><a></a>yd.compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-12" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<ul>
<li>What happens if the Dask chunks=(10000,10000)?</li>
<li>What happens if the Dask chunks=(30,30)?</li>
<li>For Dask arrays, compute the mean along <code>axis=1</code> of the sum of the x array and its transpose.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- **Solution** -->
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- x_sum = xd + xd.T -->
<!-- res = x_sum.mean(axis=1) -->
<!-- res.compute() -->
<!-- ``` -->
</div>
</div>
</div>
</section>
<section id="dask-arrays-13" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Choosing good chunk sizes</strong></p>
</div>
<div class="callout-content">
<p>We can think of Dask arrays as a big structure composed by chunks of a smaller size, where these chunks are typically an a single <code>numpy</code> array, and they are all arranged to form a larger Dask array.</p>
<p>If you have a Dask array and want to know more information about chunks and their size, you can use the <code>chunksize</code> and <code>chunks</code> attributes to access this information. If you are in a jupyter notebook you can also visualize the Dask array via its HTML representation.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a></a>darr <span class="op">=</span> da.random.random((<span class="dv">1000</span>, <span class="dv">1000</span>, <span class="dv">1000</span>))</span>
<span id="cb54-2"><a></a>darr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-14" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Choosing good chunk sizes</strong></p>
</div>
<div class="callout-content">
<p>Notice that when we created the Dask array, we did not specify the <code>chunks</code>. Dask has set by default <code>chunks='auto'</code> which accommodates ideal chunk sizes. To learn more on how auto-chunking works you can go to this documentation <a href="https://docs.dask.org/en/stable/array-chunks.html#automatic-chunking">here</a>.</p>
<ul>
<li><code>darr.chunksize</code> shows the largest chunk size.</li>
<li>But if your array have irregular chunks, <code>darr.chunks</code> will show you the explicit sizes of all the chunks along all the dimensions of your dask array.</li>
</ul>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a></a>darr.chunksize</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a></a>darr.chunks</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-15" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Choosing good chunk sizes</strong></p>
</div>
<div class="callout-content">
<p>Let’s modify our example to see explore chunking a bit more. We can rechunk our array:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a></a>darr <span class="op">=</span> darr.rechunk({<span class="dv">0</span>: <span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>: <span class="dv">100</span>, <span class="dv">2</span>: <span class="st">"auto"</span>})</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb58"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a></a>darr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a></a>darr.chunksize</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a></a>darr.chunks</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-16" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<ul>
<li>What does -1 do when specify as the chunk on a certain axis?</li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-17" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-warning no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Too small is a problem</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>If your chunks are too small, the amount of actual work done by every task is very tiny, and the overhead of coordinating all these tasks results in a very inefficient process.</p></li>
<li><p>In general, the dask scheduler takes approximately one millisecond to coordinate a single task. That means we want the computation time to be comparatively large, i.e in the order of seconds.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-18" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-important no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Too big is a problem</strong></p>
</div>
<div class="callout-content">
<ul>
<li><p>If your chunks are too big, this is also a problem because you will likely run out of memory.</p></li>
<li><p>You will start seeing in the dashboard that data is being spill to disk and this will lead to performance decrements.</p></li>
<li><p>If we load to much data into memory, Dask workers will start to spill data to disk to avoid crashing.</p></li>
<li><p>To watch out for this you can look at the worker memory plot on the dashboard.</p></li>
<li><p>Orange bars are a warning you are close to the limit, and gray means data is being spilled to disk.</p></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-19" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Rules of thumb</strong></p>
</div>
<div class="callout-content">
<ul>
<li>Users have reported that chunk sizes smaller than 1MB tend to be bad. In general, a chunk size between <strong>100MB and 1GB is good</strong>, while going over 1 or 2GB means you have a really big dataset and/or a lot of memory available per worker.</li>
<li>Upper bound: Avoid very large task graphs. More than 10,000 or 100,000 chunks may start to perform poorly.</li>
<li>Lower bound: To get the advantage of parallelization, you need the number of chunks to at least equal the number of worker cores available (or better, the number of worker cores times 2). Otherwise, some workers will stay idle.</li>
<li>The time taken to compute each task should be much larger than the time needed to schedule the task. The Dask scheduler takes roughly 1 millisecond to coordinate a single task, so a good task computation time would be in the order of seconds (not milliseconds).</li>
<li>Chunks should be aligned with array storage on disk. Modern NDArray storage formats (HDF5, NetCDF, TIFF, Zarr) allow arrays to be stored in chunks so that the blocks of data can be pulled efficiently. However, data stores often chunk more finely than is ideal for Dask array, so it is common to choose a chunking that is a multiple of your storage chunk size, otherwise you might incur high overhead. For example, if you are loading data that is chunked in blocks of (100, 100), the you might might choose a chunking strategy more like (1000, 2000) that is larger but still divisible by (100, 100).</li>
</ul>
<p>For more more advice on chunking see https://docs.dask.org/en/stable/array-chunks.html</p>
</div>
</div>
</div>
</section>
<section id="dask-arrays-20" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Example of chunked data with Zarr</strong></p>
</div>
<div class="callout-content">
<p>Zarr is a format for the storage of chunked, compressed, N-dimensional arrays. Zarr provides classes and functions for working with N-dimensional arrays that behave like NumPy arrays (Dask array behave like Numpy arrays) but whose data is divided into chunks and each chunk is compressed. If you are already familiar with HDF5 then Zarr arrays provide similar functionality, but with some additional flexibility.</p>
<p>For extra material check the <a href="https://zarr.readthedocs.io/en/stable/tutorial.html">Zarr tutorial</a></p>
<p><strong>Let’s read an array from zarr:</strong></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a></a><span class="im">import</span> zarr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a></a>a <span class="op">=</span> da.from_zarr(<span class="st">"data/random.zarr"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb63"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a></a>a</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-21" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Example of chunked data with Zarr</strong></p>
</div>
<div class="callout-content">
<p>Notice that the array is already chunked, and we didn’t specify anything when loading it. Now notice that the chunks have a nice chunk size, let’s compute the mean and see how long it takes to run</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a></a><span class="op">%%</span>time</span>
<span id="cb64-2"><a></a>a.mean().compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Let’s load a separate example where the <code>chunksize</code> is much smaller, and see what happen</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a></a>b <span class="op">=</span> da.from_zarr(<span class="st">"data/random_sc.zarr"</span>)</span>
<span id="cb65-2"><a></a>b</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a></a><span class="op">%%</span>time</span>
<span id="cb66-2"><a></a>b.mean().compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-22" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Exercise</strong></p>
</div>
<div class="callout-content">
<p>Provide a <code>chunksize</code> when reading <code>b</code> that will improve the time of computation of the mean. Try multiple <code>chunks</code> values and see what happens.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<!-- ```python -->
<!-- #| jupyter: {source_hidden: true} -->
<!-- #| tags: [] -->
<!-- # 1 possible Solution (imitate original). chunks will vary if you are in binder -->
<!-- c = da.from_zarr("data/random_sc.zarr", chunks=(6250000,)) -->
<!-- c -->
<!-- ``` -->
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a></a><span class="op">%%</span>time</span>
<span id="cb68-2"><a></a>c.mean().compute()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-23" class="slide level2 scrollable">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Xarray</strong></p>
</div>
<div class="callout-content">
<p>In some applications we have multidimensional data, and sometimes working with all this dimensions can be confusing. Xarray is an open source project and Python package that makes working with labeled multi-dimensional arrays easier.</p>
<p>Let’s learn how to use xarray and Dask together:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a></a><span class="im">import</span> xarray <span class="im">as</span> xr</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a></a>ds <span class="op">=</span> xr.tutorial.open_dataset(</span>
<span id="cb70-2"><a></a>    <span class="st">"air_temperature"</span>,</span>
<span id="cb70-3"><a></a>    chunks<span class="op">=</span>{  <span class="co"># this tells xarray to open the dataset as a dask array</span></span>
<span id="cb70-4"><a></a>        <span class="st">"lat"</span>: <span class="dv">25</span>,</span>
<span id="cb70-5"><a></a>        <span class="st">"lon"</span>: <span class="dv">25</span>,</span>
<span id="cb70-6"><a></a>        <span class="st">"time"</span>: <span class="op">-</span><span class="dv">1</span>,</span>
<span id="cb70-7"><a></a>    },</span>
<span id="cb70-8"><a></a>)</span>
<span id="cb70-9"><a></a>ds</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb71"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a></a>ds.air</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a></a>ds.air.chunks</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb73"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a></a>mean <span class="op">=</span> ds.air.mean(<span class="st">"time"</span>)  <span class="co"># no activity on dashboard</span></span>
<span id="cb73-2"><a></a>mean  <span class="co"># contains a dask array</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a></a><span class="co"># we will see dashboard activity</span></span>
<span id="cb74-2"><a></a>mean.load()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-24" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Standard Xarray Operations</strong></p>
</div>
<div class="callout-content">
<p>Let’s grab the air variable and do some operations. Operations using xarray objects are identical, regardless if the underlying data is stored as a Dask array or a NumPy array.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb75"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a></a>dair <span class="op">=</span> ds.air</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a></a>dair2 <span class="op">=</span> dair.groupby(<span class="st">"time.month"</span>).mean(<span class="st">"time"</span>)</span>
<span id="cb76-2"><a></a>dair_new <span class="op">=</span> dair <span class="op">-</span> dair2</span>
<span id="cb76-3"><a></a>dair_new</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Call <code>.compute()</code> or <code>.load()</code> when you want your result as a <code>xarray.DataArray</code> with data stored as NumPy arrays.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb77"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a></a><span class="co"># things happen in the dashboard</span></span>
<span id="cb77-2"><a></a>dair_new.load()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-25" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Time Series Operations with xarray</strong></p>
</div>
<div class="callout-content">
<p>Because we have a datetime index time-series operations work efficiently, for example we can do a resample and then plot the result.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a></a>dair_resample <span class="op">=</span> dair.resample(time<span class="op">=</span><span class="st">"1w"</span>).mean(<span class="st">"time"</span>).std(<span class="st">"time"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb79"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a></a>dair_resample.load().plot(figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="dask-arrays-26" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Learn More</strong></p>
</div>
<div class="callout-content">
<p>Both xarray and zarr have their own tutorials that go into greater depth:</p>
<ul>
<li><a href="https://zarr.readthedocs.io/en/stable/tutorial.html">Zarr tutorial</a></li>
<li><a href="https://tutorial.xarray.dev/intro.html">Xarray tutorial</a></li>
</ul>
</div>
</div>
</div>
</section>
<section id="dask-arrays-27" class="slide level2">
<h2>Dask Arrays</h2>
<div class="callout callout-note no-icon callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<p><strong>Close your cluster</strong></p>
</div>
<div class="callout-content">
<p>It’s good practice to close any Dask cluster you create:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a></a>client.shutdown()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
</div>
</section>
<section id="useful-links" class="slide level2 font8">
<h2>Useful Links</h2>
<ul>
<li>Reference
<ul>
<li><a href="https://dask.org/">Docs</a></li>
<li><a href="https://examples.dask.org/">Examples</a></li>
<li><a href="https://github.com/dask/dask/">Code</a></li>
<li><a href="https://blog.dask.org/">Blog</a></li>
</ul></li>
<li>Ask for help
<ul>
<li><a href="http://stackoverflow.com/questions/tagged/dask"><code>dask</code></a> tag on Stack Overflow, for usage questions</li>
<li><a href="https://github.com/dask/dask/issues/new">github issues</a> for bug reports and feature requests</li>
<li><a href="https://dask.discourse.group/">discourse forum</a> for general, non-bug, questions and discussion</li>
<li>Attend a live tutorial</li>
</ul></li>
</ul>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">

</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="site_libs/revealjs/plugin/multiplex/socket.io.js"></script>
  <script src="site_libs/revealjs/plugin/multiplex/multiplex.js"></script>
  <script src="site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="site_libs/revealjs/plugin/search/search.js"></script>
  <script src="site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': true,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'multiplex': {"url":"https://mplex.vitv.ly","secret":null,"id":"c98a9f6491ac4446afaff3a81eced102c969d99b2e789cbc609eeb67a517bb73"},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@2.7.9/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script id="quarto-html-after-body" type="application/javascript">
      window.document.addEventListener("DOMContentLoaded", function (event) {
        const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
        tabsets.forEach(function(tabset) {
          const tabby = new Tabby('#' + tabset.id);
        });
        const isCodeAnnotation = (el) => {
          for (const clz of el.classList) {
            if (clz.startsWith('code-annotation-')) {                     
              return true;
            }
          }
          return false;
        }
        const onCopySuccess = function(e) {
          // button target
          const button = e.trigger;
          // don't keep focus
          button.blur();
          // flash "checked"
          button.classList.add('code-copy-button-checked');
          var currentTitle = button.getAttribute("title");
          button.setAttribute("title", "Copied!");
          let tooltip;
          if (window.bootstrap) {
            button.setAttribute("data-bs-toggle", "tooltip");
            button.setAttribute("data-bs-placement", "left");
            button.setAttribute("data-bs-title", "Copied!");
            tooltip = new bootstrap.Tooltip(button, 
              { trigger: "manual", 
                customClass: "code-copy-button-tooltip",
                offset: [0, -8]});
            tooltip.show();    
          }
          setTimeout(function() {
            if (tooltip) {
              tooltip.hide();
              button.removeAttribute("data-bs-title");
              button.removeAttribute("data-bs-toggle");
              button.removeAttribute("data-bs-placement");
            }
            button.setAttribute("title", currentTitle);
            button.classList.remove('code-copy-button-checked');
          }, 1000);
          // clear code selection
          e.clearSelection();
        }
        const getTextToCopy = function(trigger) {
          const outerScaffold = trigger.parentElement.cloneNode(true);
          const codeEl = outerScaffold.querySelector('code');
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
        }
        const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
          text: getTextToCopy
        });
        clipboard.on('success', onCopySuccess);
        if (window.document.getElementById('quarto-embedded-source-code-modal')) {
          const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
            text: getTextToCopy,
            container: window.document.getElementById('quarto-embedded-source-code-modal')
          });
          clipboardModal.on('success', onCopySuccess);
        }
          var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
          var mailtoRegex = new RegExp(/^mailto:/);
            var filterRegex = new RegExp("https:\/\/dslnu\.github\.io\/data_analytics\/");
          var isInternal = (href) => {
              return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
          }
          // Inspect non-navigation links and adorn them if external
         var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
          for (var i=0; i<links.length; i++) {
            const link = links[i];
            if (!isInternal(link.href)) {
              // undo the damage that might have been done by quarto-nav.js in the case of
              // links that we want to consider external
              if (link.dataset.originalHref !== undefined) {
                link.href = link.dataset.originalHref;
              }
            }
          }
        function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
          const config = {
            allowHTML: true,
            maxWidth: 500,
            delay: 100,
            arrow: false,
            appendTo: function(el) {
                return el.closest('section.slide') || el.parentElement;
            },
            interactive: true,
            interactiveBorder: 10,
            theme: 'light-border',
            placement: 'bottom-start',
          };
          if (contentFn) {
            config.content = contentFn;
          }
          if (onTriggerFn) {
            config.onTrigger = onTriggerFn;
          }
          if (onUntriggerFn) {
            config.onUntrigger = onUntriggerFn;
          }
            config['offset'] = [0,0];
            config['maxWidth'] = 700;
          window.tippy(el, config); 
        }
        const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
        for (var i=0; i<noterefs.length; i++) {
          const ref = noterefs[i];
          tippyHover(ref, function() {
            // use id or data attribute instead here
            let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
            try { href = new URL(href).hash; } catch {}
            const id = href.replace(/^#\/?/, "");
            const note = window.document.getElementById(id);
            if (note) {
              return note.innerHTML;
            } else {
              return "";
            }
          });
        }
        const findCites = (el) => {
          const parentEl = el.parentElement;
          if (parentEl) {
            const cites = parentEl.dataset.cites;
            if (cites) {
              return {
                el,
                cites: cites.split(' ')
              };
            } else {
              return findCites(el.parentElement)
            }
          } else {
            return undefined;
          }
        };
        var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
        for (var i=0; i<bibliorefs.length; i++) {
          const ref = bibliorefs[i];
          const citeInfo = findCites(ref);
          if (citeInfo) {
            tippyHover(citeInfo.el, function() {
              var popup = window.document.createElement('div');
              citeInfo.cites.forEach(function(cite) {
                var citeDiv = window.document.createElement('div');
                citeDiv.classList.add('hanging-indent');
                citeDiv.classList.add('csl-entry');
                var biblioDiv = window.document.getElementById('ref-' + cite);
                if (biblioDiv) {
                  citeDiv.innerHTML = biblioDiv.innerHTML;
                }
                popup.appendChild(citeDiv);
              });
              return popup.innerHTML;
            });
          }
        }
      });
      </script>
    

</body></html>